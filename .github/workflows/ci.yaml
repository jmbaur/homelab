# Do not manually edit this file, it is automatically generated
concurrency:
  cancel-in-progress: true
  group: ci-${{ github.ref }}
jobs:
  build-artichoke:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build artichoke
      run: nix run .#buildNixosConfigCI -- artichoke
  build-broccoli:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-24.04-arm
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build broccoli
      run: nix run .#buildNixosConfigCI -- broccoli
  build-cauliflower:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build cauliflower
      run: nix run .#buildNixosConfigCI -- cauliflower
  build-celery:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build celery
      run: nix run .#buildNixosConfigCI -- celery
  build-garlic:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-24.04-arm
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build garlic
      run: nix run .#buildNixosConfigCI -- garlic
  build-potato:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build potato
      run: nix run .#buildNixosConfigCI -- potato
  build-pumpkin:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-24.04-arm
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build pumpkin
      run: nix run .#buildNixosConfigCI -- pumpkin
  build-squash:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build squash
      run: nix run .#buildNixosConfigCI -- squash
  build-zucchini:
    needs:
    - test
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        tool-cache: true
    - uses: DeterminateSystems/nix-installer-action@main
      with:
        extra-conf: 'extra-substituters = https://cache.jmbaur.com

          extra-trusted-public-keys = cache.jmbaur.com:C3ku8BNDXgfTO7dNHK+eojm4uy7Gvotwga+EV0cfhPQ=

          '
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        CACHE_SIGNING_KEY: ${{ secrets.CACHE_SIGNING_KEY }}
      name: Build zucchini
      run: nix run .#buildNixosConfigCI -- zucchini
  test:
    permissions:
      contents: read
      id-token: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - uses: DeterminateSystems/nix-installer-action@main
    - uses: DeterminateSystems/magic-nix-cache-action@main
    - name: Nix flake check
      run: nix flake check --print-build-logs
name: ci
'on':
  push:
    branches:
    - main
  workflow_dispatch: {}

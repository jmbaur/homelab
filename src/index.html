<!DOCTYPE html>
<html>
	<head>
		<title>Garage Door</title>
	</head>
	<iframe src="/cam" width="100%" height="360" style="border:none;" allowfullscreen></iframe>
	<div id="toggle"></div>
	<script>
		const press_min_ms = 1500;
		const garage_movement_ms = 10000;
		var press;
		var locked;
		function cancel() {
			press = null;
			locked = false;
			document.body.style.backgroundColor = "green";
		}
		function start(event) {
			if (locked) {
				return;
			}
			press = Date.now();
			locked = true;
			document.body.style.backgroundColor = "darkgreen";
			window.setTimeout(function() {
				if (press != null && locked) {
					document.body.style.backgroundColor = "lightgreen";
				}
			}, press_min_ms);
		}
		function end(event) {
			if (press === null || !locked) {
				return;
			}
			const diff = Date.now() - press;
			press = null;
			if (diff < press_min_ms) {
				document.body.style.backgroundColor = "red";
				window.setTimeout(cancel, press_min_ms);
			} else {
				fetch("/toggle");
				window.setTimeout(cancel, garage_movement_ms);
			}
		}
		document.addEventListener("touchstart", start);
		document.addEventListener("mousedown", start);
		document.addEventListener("touchend", end);
		document.addEventListener("mouseup", end);
		document.addEventListener("touchcancel", cancel);
		document.addEventListener("mouseleave", cancel);
		cancel();
	</script>
</html>

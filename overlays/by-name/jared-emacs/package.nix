{
  buildEnv,
  clang-tools,
  dts-lsp,
  emacs-pgtk,
  fd,
  fennel-ls,
  fnlfmt,
  go-tools,
  gofumpt,
  gopls,
  lib,
  lua-language-server,
  nixd,
  nixfmt,
  pyright,
  ripgrep,
  ruff,
  rust-analyzer,
  rustfmt,
  shellcheck,
  shfmt,
  tex-fmt,
  texlab,
  texlive,
  tofu-ls,
  ttags,
  zig_0_15,
  zls_0_15,
}:

let
  emacs =
    (emacs-pgtk.overrideAttrs (old: {
      configureFlags = (old.configureFlags or [ ]) ++ [ (lib.withFeature true "sound") ];
    })).pkgs.withPackages
      (
        epkgs: with epkgs; [
          company
          direnv
          dts-mode
          eat
          evil
          evil-collection
          evil-commentary
          evil-numbers
          evil-surround
          fennel-mode
          geiser
          go-mode
          haskell-mode
          janet-mode
          magit
          markdown-mode
          nix-mode
          racket-mode
          rg
          rust-mode
          slime
          sops
          terraform-mode
          typescript-mode
          vterm
          zig-mode
        ]
      );
in
buildEnv {
  name = "jared-emacs";
  meta.mainProgram = "emacs";
  paths = [
    clang-tools
    dts-lsp
    emacs
    fd
    fennel-ls
    fnlfmt
    go-tools
    gofumpt
    gopls
    lua-language-server
    nixd
    nixfmt
    pyright
    ripgrep
    ruff
    rust-analyzer
    rustfmt
    shellcheck
    shfmt
    tex-fmt
    texlab
    texlive.pkgs.latexmk
    tofu-ls
    ttags
    zig_0_15
    zls_0_15
  ];
}

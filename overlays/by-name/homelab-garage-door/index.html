<!DOCTYPE html>
<html>
	<head>
		<title>Garage Door</title>
	</head>
	<div id="toggle"></div>
	<script>
		const press_min_ms = 1500;
		const garage_movement_ms = 10000;
		var press;
		var locked;
		function reset() {
			press = null;
			locked = false;
			document.body.style.backgroundColor = "green";
		}
		reset();
		function isMobileDevice() {
			const userAgent = navigator.userAgent || navigator.vendor || window.opera;
			if (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent)) {
				return true;
			}
			return false;
		}
		const startevent = isMobileDevice() ? "touchstart" : "mousedown";
		const endevent = isMobileDevice() ? "touchend" : "mouseup";
		const cancelevent = isMobileDevice() ? "touchcancel" : "mouseleave";
		document.addEventListener(startevent, function(event) {
			if (locked) {
				return;
			}
			press = Date.now();
			locked = true;
			document.body.style.backgroundColor = "darkgreen";
			window.setTimeout(function() {
				if (press != null && locked) {
					document.body.style.backgroundColor = "lightgreen";
				}
			}, press_min_ms);
		});
		document.addEventListener(endevent, function(event) {
			if (press === null || !locked) {
				return;
			}
			const diff = Date.now() - press;
			press = null;
			if (diff < press_min_ms) {
				document.body.style.backgroundColor = "red";
				window.setTimeout(reset, press_min_ms);
			} else {
				fetch("/toggle");
				window.setTimeout(reset, garage_movement_ms);
			}
		});
		document.addEventListener(cancelevent, reset);
	</script>
</html>
